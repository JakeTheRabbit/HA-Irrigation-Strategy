# ================================================================
# CROP STEERING SYSTEM - COMPREHENSIVE DASHBOARD
# ================================================================
# Modern unified dashboard for the Crop Steering system
# Includes all features: monitoring, control, analytics, and settings
# Updated for Correct Package Entity Names
# ================================================================

type: vertical-stack
title: üå± Crop Steering System
cards:
  # ================================================================
  # SYSTEM STATUS & CONTROL
  # ================================================================
  - type: horizontal-stack
    cards:
      # Current Status Overview
      - type: entities
        title: üìä System Status
        show_header_toggle: false
        entities:
          - entity: input_select.cs_crop_steering_phase
            name: Current Phase
            icon: mdi:timeline-clock
          - entity: input_select.cs_steering_mode
            name: Steering Mode
            icon: mdi:leaf-maple
          - entity: sensor.cs_time_since_last_irrigation
            name: Last Irrigation
            icon: mdi:water-clock
          - type: divider
          - entity: sensor.cs_configured_avg_vwc
            name: Average VWC
            icon: mdi:water-percent
          - entity: sensor.cs_configured_avg_ec
            name: Average EC
            icon: mdi:flash
          - entity: sensor.cs_ec_ratio
            name: EC Ratio
            icon: mdi:percent

      # Quick Controls
      - type: entities
        title: üéÆ Quick Controls
        show_header_toggle: false
        entities:
          - entity: input_select.cs_steering_mode
            name: Steering Mode
          - entity: input_select.cs_crop_steering_phase
            name: Force Phase
          - entity: input_select.cs_crop_type_profile
            name: Crop Type
          - type: divider
          - entity: input_boolean.cs_zone_1_enabled
            name: Zone 1
            icon: mdi:valve
          - entity: input_boolean.cs_zone_2_enabled
            name: Zone 2
            icon: mdi:valve
          - entity: input_boolean.cs_zone_3_enabled
            name: Zone 3
            icon: mdi:valve
          - entity: input_boolean.cs_ec_stacking_enabled
            name: EC Stacking
            icon: mdi:flask

  # ================================================================
  # ZONE MONITORING
  # ================================================================
  - type: horizontal-stack
    cards:
      # Zone 1
      - type: entities
        title: üè† Zone 1
        show_header_toggle: false
        entities:
          - entity: sensor.cs_zone_1_vwc
            name: VWC
            icon: mdi:water-percent
          - entity: sensor.cs_zone_1_ec
            name: EC
            icon: mdi:flash
          - entity: input_boolean.cs_zone_1_enabled
            name: Enabled
            icon: mdi:power
          - type: divider
          - entity: sensor.cs_zone_1_peak_vwc
            name: Peak VWC
            icon: mdi:trending-up
          - entity: sensor.cs_zone_1_valley_vwc
            name: Valley VWC
            icon: mdi:trending-down

      # Zone 2
      - type: entities
        title: üè† Zone 2
        show_header_toggle: false
        entities:
          - entity: sensor.cs_zone_2_vwc
            name: VWC
            icon: mdi:water-percent
          - entity: sensor.cs_zone_2_ec
            name: EC
            icon: mdi:flash
          - entity: input_boolean.cs_zone_2_enabled
            name: Enabled
            icon: mdi:power
          - type: divider
          - entity: sensor.cs_zone_2_peak_vwc
            name: Peak VWC
            icon: mdi:trending-up
          - entity: sensor.cs_zone_2_valley_vwc
            name: Valley VWC
            icon: mdi:trending-down

      # Zone 3
      - type: entities
        title: üè† Zone 3
        show_header_toggle: false
        entities:
          - entity: sensor.cs_zone_3_vwc
            name: VWC
            icon: mdi:water-percent
          - entity: sensor.cs_zone_3_ec
            name: EC
            icon: mdi:flash
          - entity: input_boolean.cs_zone_3_enabled
            name: Enabled
            icon: mdi:power
          - type: divider
          - entity: sensor.cs_zone_3_peak_vwc
            name: Peak VWC
            icon: mdi:trending-up
          - entity: sensor.cs_zone_3_valley_vwc
            name: Valley VWC
            icon: mdi:trending-down

  # ================================================================
  # PERFORMANCE ANALYTICS
  # ================================================================
  - type: horizontal-stack
    cards:
      # Analytics
      - type: entities
        title: üìà Performance Analytics
        show_header_toggle: false
        entities:
          - entity: sensor.cs_irrigation_efficiency
            name: Irrigation Efficiency
            icon: mdi:percent
          - entity: sensor.cs_water_usage_daily
            name: Daily Water Usage
            icon: mdi:water
          - entity: sensor.cs_dryback_percentage
            name: Current Dryback
            icon: mdi:water-minus
          - type: divider
          - entity: sensor.cs_24h_efficiency
            name: 24h Efficiency
            icon: mdi:chart-line
          - entity: sensor.cs_7d_water_usage
            name: 7d Water Usage
            icon: mdi:chart-box-outline

      # System Health
      - type: entities
        title: üîß System Health
        show_header_toggle: false
        entities:
          - entity: sensor.cs_system_status
            name: System Status
            icon: mdi:check-circle
          - entity: sensor.cs_sensor_health_score
            name: Sensor Health
            icon: mdi:heart-pulse
          - entity: sensor.cs_last_irrigation_outcome
            name: Last Shot Result
            icon: mdi:water-check
          - type: divider
          - entity: binary_sensor.cs_system_enabled
            name: System Enabled
            icon: mdi:power
          - entity: binary_sensor.cs_emergency_mode
            name: Emergency Mode
            icon: mdi:alert

  # ================================================================
  # PARAMETER CONFIGURATION TABS
  # ================================================================
  - type: custom:tabbed-card
    tabs:
      # P0 Phase Settings
      - attributes:
          label: P0 - Dryback
          icon: mdi:water-minus
        card:
          type: entities
          title: üåÖ P0 Phase - Morning Dryback
          show_header_toggle: false
          entities:
            - entity: input_number.cs_p0_veg_dryback_target
              name: Vegetative Target
              icon: mdi:leaf
            - entity: input_number.cs_p0_gen_dryback_target
              name: Generative Target
              icon: mdi:flower
            - entity: input_number.cs_p0_min_wait_time
              name: Min Wait Time (min)
              icon: mdi:timer
            - entity: input_number.cs_p0_max_wait_time
              name: Max Wait Time (min)
              icon: mdi:timer-alert

      # P1 Phase Settings
      - attributes:
          label: P1 - Ramp-Up
          icon: mdi:trending-up
        card:
          type: entities
          title: üìà P1 Phase - Ramp-Up
          show_header_toggle: false
          entities:
            - entity: input_number.cs_p1_initial_shot_size_percent
              name: Initial Shot Size (%)
              icon: mdi:water-plus
            - entity: input_number.cs_p1_shot_size_increment
              name: Shot Increment (%)
              icon: mdi:plus
            - entity: input_number.cs_p1_max_shot_size_percent
              name: Max Shot Size (%)
              icon: mdi:water-sync
            - entity: input_number.cs_p1_target_vwc
              name: Target VWC (%)
              icon: mdi:target
            - entity: input_number.cs_p1_time_between_shots
              name: Time Between Shots (min)
              icon: mdi:clock-outline

      # P2 Phase Settings
      - attributes:
          label: P2 - Maintenance
          icon: mdi:water-sync
        card:
          type: entities
          title: üîÑ P2 Phase - Maintenance
          show_header_toggle: false
          entities:
            - entity: input_number.cs_p2_shot_size_percent
              name: Shot Size (%)
              icon: mdi:water
            - entity: input_number.cs_p2_vwc_threshold
              name: VWC Threshold (%)
              icon: mdi:water-alert
            - entity: input_number.cs_p2_ec_high_threshold
              name: EC High Ratio
              icon: mdi:arrow-up-bold
            - entity: input_number.cs_p2_ec_low_threshold
              name: EC Low Ratio
              icon: mdi:arrow-down-bold

      # P3 Phase Settings
      - attributes:
          label: P3 - Pre-Off
          icon: mdi:sleep
        card:
          type: entities
          title: üåô P3 Phase - Pre-Lights-Off
          show_header_toggle: false
          entities:
            - entity: input_number.cs_p3_veg_last_irrigation
              name: Veg Last Irrigation (min)
              icon: mdi:leaf
            - entity: input_number.cs_p3_gen_last_irrigation
              name: Gen Last Irrigation (min)
              icon: mdi:flower
            - entity: input_number.cs_p3_emergency_vwc_threshold
              name: Emergency VWC (%)
              icon: mdi:alert
            - entity: input_number.cs_p3_emergency_shot_size_percent
              name: Emergency Shot Size (%)
              icon: mdi:water-alert

      # EC Targets
      - attributes:
          label: EC Targets
          icon: mdi:lightning-bolt
        card:
          type: entities
          title: ‚ö° EC Target Configuration
          show_header_toggle: false
          entities:
            - type: section
              label: Vegetative EC Targets
            - entity: input_number.cs_ec_target_veg_p0
              name: P0 Target (mS/cm)
              icon: mdi:numeric-0-circle
            - entity: input_number.cs_ec_target_veg_p1
              name: P1 Target (mS/cm)
              icon: mdi:numeric-1-circle
            - entity: input_number.cs_ec_target_veg_p2
              name: P2 Target (mS/cm)
              icon: mdi:numeric-2-circle
            - entity: input_number.cs_ec_target_veg_p3
              name: P3 Target (mS/cm)
              icon: mdi:numeric-3-circle
            - type: section
              label: Generative EC Targets
            - entity: input_number.cs_ec_target_gen_p0
              name: P0 Target (mS/cm)
              icon: mdi:numeric-0-circle
            - entity: input_number.cs_ec_target_gen_p1
              name: P1 Target (mS/cm)
              icon: mdi:numeric-1-circle
            - entity: input_number.cs_ec_target_gen_p2
              name: P2 Target (mS/cm)
              icon: mdi:numeric-2-circle
            - entity: input_number.cs_ec_target_gen_p3
              name: P3 Target (mS/cm)
              icon: mdi:numeric-3-circle

      # System Configuration
      - attributes:
          label: System Config
          icon: mdi:cog
        card:
          type: entities
          title: ‚öôÔ∏è System Configuration
          show_header_toggle: false
          entities:
            - entity: input_number.cs_substrate_volume_liters
              name: Substrate Volume (L)
              icon: mdi:cube-outline
            - entity: input_number.cs_dripper_flow_rate_lph
              name: Dripper Flow Rate (L/hr)
              icon: mdi:water-pump
            - entity: input_number.cs_substrate_field_capacity
              name: Field Capacity (%)
              icon: mdi:water-percent
            - entity: input_number.cs_substrate_max_ec
              name: Maximum EC (mS/cm)
              icon: mdi:lightning-bolt
            - type: divider
            - entity: input_text.cs_config_pump_switch
              name: Pump Switch Entity
              icon: mdi:pump
            - entity: input_text.cs_config_main_line_switch
              name: Main Line Switch Entity
              icon: mdi:valve

  # ================================================================
  # HARDWARE STATUS
  # ================================================================
  - type: entities
    title: üîß Hardware Status
    show_header_toggle: false
    entities:
      - entity: binary_sensor.cs_pump_status
        name: Pump Status
        icon: mdi:pump
      - entity: binary_sensor.cs_main_line_status
        name: Main Line Status
        icon: mdi:valve
      - entity: binary_sensor.cs_zone_1_valve_status
        name: Zone 1 Valve
        icon: mdi:valve
      - entity: binary_sensor.cs_zone_2_valve_status
        name: Zone 2 Valve
        icon: mdi:valve
      - entity: binary_sensor.cs_zone_3_valve_status
        name: Zone 3 Valve
        icon: mdi:valve
      - type: divider
      - entity: sensor.cs_last_irrigation_duration
        name: Last Irrigation Duration
        icon: mdi:timer
      - entity: sensor.cs_irrigation_shots_today
        name: Shots Today
        icon: mdi:counter