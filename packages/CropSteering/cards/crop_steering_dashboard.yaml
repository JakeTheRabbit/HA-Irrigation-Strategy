# ================================================================
# CROP STEERING SYSTEM - COMPREHENSIVE DASHBOARD
# ================================================================
# Modern unified dashboard for the Crop Steering system
# Includes all features: monitoring, control, analytics, and settings
# ================================================================

type: vertical-stack
title: üå± Crop Steering System
cards:
  # ================================================================
  # SYSTEM STATUS & CONTROL
  # ================================================================
  - type: horizontal-stack
    cards:
      # Current Status Overview
      - type: entities
        title: üìä System Status
        show_header_toggle: false
        entities:
          - entity: sensor.cs_current_phase
            name: Current Phase
            icon: mdi:timeline-clock
          - entity: sensor.cs_steering_mode
            name: Steering Mode
            icon: mdi:leaf-maple
          - entity: sensor.cs_time_since_last_irrigation
            name: Last Irrigation
            icon: mdi:water-clock
          - type: divider
          - entity: sensor.cs_configured_avg_vwc
            name: Average VWC
            icon: mdi:water-percent
          - entity: sensor.cs_configured_avg_ec
            name: Average EC
            icon: mdi:flash
          - entity: sensor.cs_ec_ratio
            name: EC Ratio
            icon: mdi:percent

      # Quick Controls
      - type: entities
        title: üéÆ Quick Controls
        show_header_toggle: false
        entities:
          - entity: input_select.cs_steering_mode
            name: Steering Mode
          - entity: input_select.cs_crop_steering_phase
            name: Force Phase
          - type: divider
          - entity: input_boolean.cs_zone_1_enabled
            name: Zone 1
            icon: mdi:valve
          - entity: input_boolean.cs_zone_2_enabled
            name: Zone 2
            icon: mdi:valve
          - entity: input_boolean.cs_zone_3_enabled
            name: Zone 3
            icon: mdi:valve

  # ================================================================
  # ZONE MONITORING
  # ================================================================
  - type: horizontal-stack
    cards:
      # Zone 1
      - type: entities
        title: üè† Zone 1
        show_header_toggle: false
        entities:
          - entity: sensor.cs_zone_1_vwc
            name: VWC
            icon: mdi:water-percent
          - entity: sensor.cs_zone_1_ec
            name: EC
            icon: mdi:flash
          - entity: input_boolean.cs_zone_1_enabled
            name: Enabled
            icon: mdi:power

      # Zone 2
      - type: entities
        title: üè† Zone 2
        show_header_toggle: false
        entities:
          - entity: sensor.cs_zone_2_vwc
            name: VWC
            icon: mdi:water-percent
          - entity: sensor.cs_zone_2_ec
            name: EC
            icon: mdi:flash
          - entity: input_boolean.cs_zone_2_enabled
            name: Enabled
            icon: mdi:power

      # Zone 3
      - type: entities
        title: üè† Zone 3
        show_header_toggle: false
        entities:
          - entity: sensor.cs_zone_3_vwc
            name: VWC
            icon: mdi:water-percent
          - entity: sensor.cs_zone_3_ec
            name: EC
            icon: mdi:flash
          - entity: input_boolean.cs_zone_3_enabled
            name: Enabled
            icon: mdi:power

  # ================================================================
  # IRRIGATION HARDWARE STATUS
  # ================================================================
  - type: entities
    title: üîß Hardware Status
    show_header_toggle: false
    entities:
      - type: section
        label: Irrigation System
      - entity: sensor.cs_pump_status
        name: Main Pump
        icon: mdi:water-pump
      - entity: sensor.cs_main_line_status
        name: Main Line Valve
        icon: mdi:pipe
      - entity: sensor.cs_zone_1_valve_status
        name: Zone 1 Valve
        icon: mdi:valve
      - entity: sensor.cs_zone_2_valve_status
        name: Zone 2 Valve
        icon: mdi:valve
      - entity: sensor.cs_zone_3_valve_status
        name: Zone 3 Valve
        icon: mdi:valve

  # ================================================================
  # PHASE PARAMETERS (TABS)
  # ================================================================
  - type: custom:tabbed-card
    options:
      "--mdc-theme-primary": "#2196F3"
    tabs:
      # P0 Phase Settings
      - card:
          type: entities
          title: P0 - Morning Dryback
          entities:
            - entity: input_number.cs_p0_veg_dryback_target
              name: Veg Dryback Target (%)
            - entity: input_number.cs_p0_gen_dryback_target
              name: Gen Dryback Target (%)
            - entity: input_number.cs_p0_min_wait_time
              name: Min Wait Time (min)
            - entity: input_number.cs_p0_max_wait_time
              name: Max Wait Time (min)
        label: P0
        icon: mdi:weather-sunset-up

      # P1 Phase Settings
      - card:
          type: entities
          title: P1 - Ramp-Up Phase
          entities:
            - entity: input_number.cs_p1_initial_shot_size_percent
              name: Initial Shot Size (%)
            - entity: input_number.cs_p1_shot_size_increment_percent
              name: Shot Size Increment (%)
            - entity: input_number.cs_p1_max_shot_size_percent
              name: Max Shot Size (%)
            - entity: input_number.cs_p1_time_between_shots
              name: Time Between Shots (min)
            - entity: input_number.cs_p1_target_vwc
              name: Target VWC (%)
            - entity: input_number.cs_p1_max_shots
              name: Max Shots
            - entity: input_number.cs_p1_min_shots
              name: Min Shots
        label: P1
        icon: mdi:trending-up

      # P2 Phase Settings
      - card:
          type: entities
          title: P2 - Maintenance Phase
          entities:
            - entity: input_number.cs_p2_shot_size_percent
              name: Shot Size (%)
            - entity: input_number.cs_p2_vwc_threshold
              name: VWC Threshold (%)
            - entity: input_number.cs_p2_ec_high_threshold
              name: EC High Threshold
            - entity: input_number.cs_p2_ec_low_threshold
              name: EC Low Threshold
            - entity: input_number.cs_p2_vwc_adjustment_high_ec
              name: VWC Adj High EC (%)
            - entity: input_number.cs_p2_vwc_adjustment_low_ec
              name: VWC Adj Low EC (%)
        label: P2
        icon: mdi:water

      # P3 Phase Settings
      - card:
          type: entities
          title: P3 - Pre-Lights-Off
          entities:
            - entity: input_number.cs_p3_veg_last_irrigation
              name: Veg Last Irrigation (min)
            - entity: input_number.cs_p3_gen_last_irrigation
              name: Gen Last Irrigation (min)
            - entity: input_number.cs_p3_emergency_vwc_threshold
              name: Emergency VWC Threshold (%)
            - entity: input_number.cs_p3_emergency_shot_size_percent
              name: Emergency Shot Size (%)
        label: P3
        icon: mdi:weather-sunset-down

  # ================================================================
  # EC TARGETS
  # ================================================================
  - type: horizontal-stack
    cards:
      # Vegetative EC Targets
      - type: entities
        title: üåø Vegetative EC Targets
        show_header_toggle: false
        entities:
          - entity: input_number.cs_ec_target_veg_p0
            name: P0 Target (mS/cm)
          - entity: input_number.cs_ec_target_veg_p1
            name: P1 Target (mS/cm)
          - entity: input_number.cs_ec_target_veg_p2
            name: P2 Target (mS/cm)
          - entity: input_number.cs_ec_target_veg_p3
            name: P3 Target (mS/cm)

      # Generative EC Targets
      - type: entities
        title: üå∏ Generative EC Targets
        show_header_toggle: false
        entities:
          - entity: input_number.cs_ec_target_gen_p0
            name: P0 Target (mS/cm)
          - entity: input_number.cs_ec_target_gen_p1
            name: P1 Target (mS/cm)
          - entity: input_number.cs_ec_target_gen_p2
            name: P2 Target (mS/cm)
          - entity: input_number.cs_ec_target_gen_p3
            name: P3 Target (mS/cm)

  # ================================================================
  # SUBSTRATE & SYSTEM SETTINGS
  # ================================================================
  - type: horizontal-stack
    cards:
      # Substrate Properties
      - type: entities
        title: ü™¥ Substrate Properties
        show_header_toggle: false
        entities:
          - entity: input_number.cs_substrate_volume
            name: Volume (L)
          - entity: input_number.cs_dripper_flow_rate
            name: Flow Rate (L/hr)
          - entity: input_number.cs_substrate_field_capacity
            name: Field Capacity (%)
          - entity: input_number.cs_substrate_max_ec
            name: Max Safe EC (mS/cm)

      # Advanced Features
      - type: entities
        title: ‚öôÔ∏è Advanced Features
        show_header_toggle: false
        entities:
          - entity: input_boolean.cs_ec_stacking_enabled
            name: EC Stacking
            icon: mdi:chart-line-stacked
          - entity: input_select.cs_crop_type_profile
            name: Crop Profile
            icon: mdi:sprout-outline
          - entity: input_number.cs_days_since_flip
            name: Days Since Flip
            icon: mdi:calendar-clock

  # ================================================================
  # ANALYTICS & HISTORY (if available)
  # ================================================================
  - type: conditional
    conditions:
      - entity: sensor.cs_irrigation_efficiency_24h
        state_not: "unavailable"
    card:
      type: horizontal-stack
      cards:
        # Performance Metrics
        - type: entities
          title: üìà Performance Analytics
          show_header_toggle: false
          entities:
            - entity: sensor.cs_irrigation_efficiency_24h
              name: 24h Efficiency (%)
              icon: mdi:chart-line
            - entity: sensor.cs_water_efficiency_score
              name: Water Efficiency
              icon: mdi:water-check
            - entity: sensor.cs_total_shots_24h
              name: 24h Total Shots
              icon: mdi:counter

        # Dryback Analytics
        - type: entities
          title: üìä Dryback Analytics
          show_header_toggle: false
          entities:
            - entity: sensor.cs_dryback_potential_peak
              name: Potential Peak (%)
              icon: mdi:chart-bell-curve
            - entity: sensor.cs_dryback_last_peak_vwc
              name: Last Peak VWC (%)
              icon: mdi:chart-bell-curve
            - entity: sensor.cs_dryback_last_percentage
              name: Last Dryback (%)
              icon: mdi:percent

  # ================================================================
  # SYSTEM INFORMATION
  # ================================================================
  - type: entities
    title: ‚ÑπÔ∏è System Information
    show_header_toggle: false
    entities:
      - type: section
        label: Configuration
      - entity: sensor.cs_configured_vwc_sensors_count
        name: VWC Sensors Configured
        icon: mdi:water-percent
      - entity: sensor.cs_configured_ec_sensors_count
        name: EC Sensors Configured
        icon: mdi:flash
      - entity: sensor.cs_active_zones_count
        name: Active Zones
        icon: mdi:valve
      - type: section
        label: Last Activity
      - entity: sensor.cs_last_shot_time
        name: Last Shot Time
        icon: mdi:clock-check
      - entity: sensor.cs_next_check_time
        name: Next Check Time
        icon: mdi:clock-outline