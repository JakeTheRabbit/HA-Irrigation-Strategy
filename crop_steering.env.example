# ============================================================================
# CROP STEERING SYSTEM - CONFIGURATION FILE
# ============================================================================
#
# Complete .env configuration example for Home Assistant Crop Steering System
# Version: 2.3.1
#
# QUICK START:
# 1. Copy this file to your Home Assistant config directory
# 2. Rename to: crop_steering.env
# 3. Replace placeholder entity IDs with your actual Home Assistant entities
# 4. Install integration: Settings → Devices & Services → Add Integration → Crop Steering
# 5. Choose "Load from crop_steering.env file"
#
# ENTITY ID FORMATS:
# - Switches must start with "switch." (e.g., switch.irrigation_relay_1)
# - Sensors must start with "sensor." (e.g., sensor.vwc_zone_1_front)
# - Lights must start with "light." or "switch." (e.g., light.grow_lights)
#
# VALIDATION:
# - Entity IDs are validated during integration setup
# - Missing entities will be reported (can proceed with warnings)
# - Invalid formats will block integration setup
#
# ============================================================================

# ============================================================================
# ZONE CONFIGURATION
# ============================================================================
#
# AUTOMATIC ZONE DETECTION:
# The system automatically detects zones by scanning for "ZONE_N_SWITCH" entries.
# You can have as many zones as your hardware supports (no limit!).
#
# REQUIRED PER ZONE:
# - ZONE_N_SWITCH: The relay/valve controlling this zone's irrigation
#
# OPTIONAL PER ZONE:
# - VWC sensors (front/back): Volumetric Water Content measurement
# - EC sensors (front/back): Electrical Conductivity measurement
# - PLANT_COUNT: Number of plants in this zone (default: 4)
# - MAX_DAILY_VOLUME: Maximum liters per day for safety (default: 20.0)
# - SHOT_MULTIPLIER: Adjustment factor for this zone (default: 1.0)
#
# NAMING PATTERNS (choose what matches your setup):
# - Sequential: switch.irrigation_relay_1, switch.irrigation_relay_2, ...
# - Named: switch.zone_veg_tent, switch.zone_flower_room, ...
# - ESPHome: switch.esphome_relay_1, switch.esphome_relay_2, ...
# - Tasmota: switch.tasmota_relay1, switch.tasmota_relay2, ...
#
# GAPS ALLOWED:
# You can skip zone numbers (e.g., ZONE_1, ZONE_3, ZONE_5 = 3 zones detected)
#
# ============================================================================

# --- ZONE 1 ---
ZONE_1_SWITCH=switch.irrigation_relay_1
ZONE_1_VWC_FRONT=sensor.vwc_zone_1_front
ZONE_1_VWC_BACK=sensor.vwc_zone_1_back
ZONE_1_EC_FRONT=sensor.ec_zone_1_front
ZONE_1_EC_BACK=sensor.ec_zone_1_back
ZONE_1_PLANT_COUNT=4
ZONE_1_MAX_DAILY_VOLUME=20.0
ZONE_1_SHOT_MULTIPLIER=1.0

# --- ZONE 2 ---
ZONE_2_SWITCH=switch.irrigation_relay_2
ZONE_2_VWC_FRONT=sensor.vwc_zone_2_front
ZONE_2_VWC_BACK=sensor.vwc_zone_2_back
ZONE_2_EC_FRONT=sensor.ec_zone_2_front
ZONE_2_EC_BACK=sensor.ec_zone_2_back
ZONE_2_PLANT_COUNT=4
ZONE_2_MAX_DAILY_VOLUME=20.0
ZONE_2_SHOT_MULTIPLIER=1.0

# --- ZONE 3 (Optional - delete if not using) ---
ZONE_3_SWITCH=switch.irrigation_relay_3
ZONE_3_VWC_FRONT=sensor.vwc_zone_3_front
ZONE_3_VWC_BACK=sensor.vwc_zone_3_back
ZONE_3_EC_FRONT=sensor.ec_zone_3_front
ZONE_3_EC_BACK=sensor.ec_zone_3_back
ZONE_3_PLANT_COUNT=4
ZONE_3_MAX_DAILY_VOLUME=20.0
ZONE_3_SHOT_MULTIPLIER=1.0

# --- ZONE 4 (Optional - delete if not using) ---
ZONE_4_SWITCH=switch.irrigation_relay_4
ZONE_4_VWC_FRONT=sensor.vwc_zone_4_front
ZONE_4_VWC_BACK=sensor.vwc_zone_4_back
ZONE_4_EC_FRONT=sensor.ec_zone_4_front
ZONE_4_EC_BACK=sensor.ec_zone_4_back
ZONE_4_PLANT_COUNT=4
ZONE_4_MAX_DAILY_VOLUME=20.0
ZONE_4_SHOT_MULTIPLIER=1.0

# --- ADD MORE ZONES AS NEEDED ---
# Just copy the pattern above and increment the zone number:
# ZONE_5_SWITCH=switch.irrigation_relay_5
# ZONE_5_VWC_FRONT=sensor.vwc_zone_5_front
# ...etc

# ============================================================================
# HARDWARE CONFIGURATION (REQUIRED)
# ============================================================================
#
# CRITICAL HARDWARE:
# These control the main irrigation system components and are REQUIRED
# for autonomous operation.
#
# PUMP_SWITCH: Main water pump (turns on before irrigation)
# MAIN_LINE_SWITCH: Main water valve/line (opens after pump primes)
#
# COMMON NAMING PATTERNS:
# - switch.water_pump, switch.irrigation_pump, switch.main_pump
# - switch.main_valve, switch.water_valve, switch.master_valve
#
# HARDWARE SEQUENCE:
# 1. Pump turns ON (2 second prime delay)
# 2. Main line opens (1 second stabilization)
# 3. Zone valve opens (irrigation begins)
# 4. Zone valve closes (irrigation shot complete)
# 5. Main line closes
# 6. Pump turns OFF
#
# ============================================================================

PUMP_SWITCH=switch.water_pump
MAIN_LINE_SWITCH=switch.main_valve

# OPTIONAL: Waste/flush valve for system flushing
WASTE_SWITCH=

# ============================================================================
# LIGHT SCHEDULE (Optional but Recommended)
# ============================================================================
#
# Used to determine day/night cycles for phase transitions.
# If not provided, system uses default 12hr on / 12hr off schedule.
#
# LIGHT_ENTITY: Your grow light entity
# LIGHTS_ON_TIME: Time lights turn on (HH:MM format, 24hr)
# LIGHTS_OFF_TIME: Time lights turn off (HH:MM format, 24hr)
#
# ALTERNATIVE: Set hours directly
# LIGHTS_ON_HOUR: Hour (0-23) when lights turn on
# LIGHTS_OFF_HOUR: Hour (0-23) when lights turn off
#
# EXAMPLES:
# 18/6 schedule: ON=06:00, OFF=00:00 (midnight)
# 12/12 schedule: ON=06:00, OFF=18:00
# 20/4 schedule: ON=04:00, OFF=00:00 (midnight)
#
# ============================================================================

LIGHT_ENTITY=light.grow_lights
LIGHTS_ON_TIME=06:00
LIGHTS_OFF_TIME=00:00

# Or use hour-based config:
# LIGHTS_ON_HOUR=6
# LIGHTS_OFF_HOUR=0

# ============================================================================
# ENVIRONMENTAL SENSORS (Optional)
# ============================================================================
#
# These sensors enhance automation but are not required.
# If not provided, system still functions based on VWC/EC data.
#
# TEMPERATURE_SENSOR: Room/canopy temperature (°F or °C)
# HUMIDITY_SENSOR: Relative humidity (%)
# VPD_SENSOR: Vapor Pressure Deficit (kPa) - if you have a VPD sensor/calculated entity
# WATER_LEVEL_SENSOR: Reservoir level (%) - triggers low water alerts
#
# NOTIFICATION_SERVICE: Home Assistant notify service for alerts
# Format: notify.SERVICE_NAME (e.g., notify.mobile_app, notify.telegram)
#
# ============================================================================

TEMPERATURE_SENSOR=sensor.grow_room_temperature
HUMIDITY_SENSOR=sensor.grow_room_humidity
VPD_SENSOR=sensor.grow_room_vpd
WATER_LEVEL_SENSOR=sensor.reservoir_level
NOTIFICATION_SERVICE=notify.mobile_app

# ============================================================================
# SUBSTRATE PROPERTIES
# ============================================================================
#
# Physical characteristics of your growing medium.
# These are used to calculate irrigation shot durations.
#
# SUBSTRATE_VOLUME_LITERS: Volume of each pot/container (liters)
#   - 1 gallon ≈ 3.8 liters
#   - 5 gallon pot = 19 liters
#   - 10 gallon pot = 38 liters
#   - 15 gallon pot = 57 liters
#
# DRIPPER_FLOW_RATE_LPH: Flow rate per dripper (liters per hour)
#   - Common rates: 1 LPH, 2 LPH, 4 LPH
#   - Check your dripper specifications
#   - Measure: Run dripper for 60 seconds, measure volume, multiply by 60
#
# DRIPPERS_PER_PLANT: Number of drippers per plant
#   - 1-2 for small pots
#   - 2-4 for medium pots
#   - 4-8 for large pots
#
# SUBSTRATE_FIELD_CAPACITY: Maximum VWC% before saturation/runoff
#   - Coco coir: 65-70%
#   - Peat mix: 70-75%
#   - Rockwool: 75-80%
#   - Soil: 60-65%
#
# SUBSTRATE_MAX_EC: Maximum safe EC value (mS/cm)
#   - Cannabis: 6.0-9.0 mS/cm
#   - Tomatoes: 5.0-8.0 mS/cm
#   - Lettuce: 3.0-5.0 mS/cm
#
# ============================================================================

SUBSTRATE_VOLUME_LITERS=10.0
DRIPPER_FLOW_RATE_LPH=2.0
DRIPPERS_PER_PLANT=2
SUBSTRATE_FIELD_CAPACITY=70.0
SUBSTRATE_MAX_EC=9.0

# ============================================================================
# CROP SETTINGS
# ============================================================================
#
# DEFAULT_CROP_TYPE: Starting crop type for all zones
# Options: Cannabis_Athena, Cannabis_Hybrid, Cannabis_Indica, Cannabis_Sativa,
#          Tomato, Lettuce, Basil, Custom
#
# DEFAULT_STEERING_MODE: Starting steering mode
# Options: Vegetative, Generative
#   - Vegetative: Lower EC, more frequent irrigation, promote growth
#   - Generative: Higher EC, less frequent irrigation, promote flowering/fruiting
#
# ============================================================================

DEFAULT_CROP_TYPE=Cannabis_Athena
DEFAULT_STEERING_MODE=Vegetative

# ============================================================================
# PHASE 0 (P0) - MORNING DRYBACK
# ============================================================================
#
# P0 is the first phase after lights turn on. The system waits for substrate
# moisture to drop from overnight saturation to the target dryback level.
#
# P0_VEG_DRYBACK_TARGET: Target VWC% drop in Vegetative mode
#   - Typical: 45-55% (less stress)
#   - Aggressive veg: 40-45% (more root development)
#
# P0_GEN_DRYBACK_TARGET: Target VWC% drop in Generative mode
#   - Typical: 35-45% (more stress)
#   - Aggressive gen: 30-40% (maximum stress)
#
# P0_MIN_WAIT_TIME: Minimum minutes to wait before checking dryback
#   - Prevents premature transitions
#   - Typical: 30-60 minutes
#
# P0_MAX_WAIT_TIME: Maximum minutes to wait (safety timeout)
#   - Triggers emergency irrigation if dryback not reached
#   - Typical: 90-180 minutes
#
# TRANSITION: When VWC drops to target → Move to P1 (Ramp-Up)
#
# ============================================================================

P0_VEG_DRYBACK_TARGET=50
P0_GEN_DRYBACK_TARGET=40
P0_MIN_WAIT_TIME=30
P0_MAX_WAIT_TIME=120

# ============================================================================
# PHASE 1 (P1) - RAMP-UP
# ============================================================================
#
# P1 gradually increases substrate moisture through progressive shot sizes.
# Shot sizes start small and increment until target VWC is reached.
#
# P1_INITIAL_SHOT_SIZE_PERCENT: First shot size (% of pot volume)
#   - Typical: 1.5-2.5%
#   - 10L pot at 2% = 200ml first shot
#
# P1_SHOT_SIZE_INCREMENT: Amount to increase each shot (%)
#   - Typical: 0.3-0.7%
#   - Creates gradual ramp: 2%, 2.5%, 3%, 3.5%...
#
# P1_MAX_SHOT_SIZE_PERCENT: Maximum shot size (% of pot volume)
#   - Safety limit to prevent over-watering
#   - Typical: 8-12%
#
# P1_TIME_BETWEEN_SHOTS: Minutes between irrigation shots
#   - Allows substrate to equilibrate
#   - Typical: 10-20 minutes
#
# P1_TARGET_VWC: Target moisture level to reach (%)
#   - Vegetative: 60-70%
#   - Generative: 55-65%
#
# P1_MAX_SHOTS: Maximum number of shots (safety limit)
#   - Prevents infinite loops
#   - Typical: 8-15 shots
#
# P1_MIN_SHOTS: Minimum shots before allowing P2 transition
#   - Ensures gradual saturation
#   - Typical: 3-5 shots
#
# TRANSITION: When VWC reaches target AND min shots complete → Move to P2
#
# ============================================================================

P1_INITIAL_SHOT_SIZE_PERCENT=2.0
P1_SHOT_SIZE_INCREMENT=0.5
P1_MAX_SHOT_SIZE_PERCENT=10.0
P1_TIME_BETWEEN_SHOTS=15
P1_TARGET_VWC=65
P1_MAX_SHOTS=10
P1_MIN_SHOTS=3

# ============================================================================
# PHASE 2 (P2) - MAINTENANCE
# ============================================================================
#
# P2 is the longest phase, maintaining substrate moisture and EC throughout
# the day via threshold-based irrigation.
#
# P2_SHOT_SIZE_PERCENT: Standard shot size during maintenance (%)
#   - Smaller than P1 shots
#   - Typical: 1.5-3.0%
#   - 10L pot at 2% = 200ml per shot
#
# P2_VWC_THRESHOLD: Moisture level that triggers irrigation (%)
#   - When VWC drops below this → irrigate
#   - Vegetative: 58-62%
#   - Generative: 50-58%
#
# P2_EC_HIGH_THRESHOLD: EC ratio that triggers flushing shot
#   - EC Ratio = Current EC ÷ Target EC
#   - If ratio > 1.2 (EC is 20% too high) → larger flush shot
#   - Typical: 1.15-1.3
#
# P2_EC_LOW_THRESHOLD: EC ratio that skips irrigation
#   - If ratio < 0.8 (EC is 20% too low) → skip shot, let EC rise
#   - Typical: 0.7-0.9
#
# TRIGGERS:
# - VWC < P2_VWC_THRESHOLD → Normal irrigation shot
# - EC Ratio > P2_EC_HIGH_THRESHOLD → Flush shot (larger volume)
# - EC Ratio < P2_EC_LOW_THRESHOLD → Skip shot
#
# TRANSITION: When lights-off time approaches → Move to P3
#
# ============================================================================

P2_SHOT_SIZE_PERCENT=2.0
P2_VWC_THRESHOLD=60
P2_EC_HIGH_THRESHOLD=1.2
P2_EC_LOW_THRESHOLD=0.8

# ============================================================================
# PHASE 3 (P3) - PRE-LIGHTS-OFF
# ============================================================================
#
# P3 is the final phase before lights turn off. Irrigation is minimized
# to prevent overnight saturation and root zone issues.
#
# P3_VEG_LAST_IRRIGATION: Minutes before lights-off for final irrigation (Veg)
#   - Vegetative plants dry slower
#   - Typical: 90-150 minutes
#
# P3_GEN_LAST_IRRIGATION: Minutes before lights-off for final irrigation (Gen)
#   - Generative plants need drier conditions
#   - Typical: 150-240 minutes
#
# P3_EMERGENCY_VWC_THRESHOLD: Emergency irrigation trigger (%)
#   - Only irrigate if VWC drops dangerously low
#   - Typical: 35-45%
#
# P3_EMERGENCY_SHOT_SIZE_PERCENT: Emergency shot size (%)
#   - Small rescue shot to prevent wilting
#   - Typical: 1.5-2.5%
#
# BEHAVIOR:
# - Normal: No irrigation unless emergency threshold reached
# - Emergency: Small shot if VWC < emergency threshold
#
# TRANSITION: When lights turn off → Return to P0 (next morning)
#
# ============================================================================

P3_VEG_LAST_IRRIGATION=120
P3_GEN_LAST_IRRIGATION=180
P3_EMERGENCY_VWC_THRESHOLD=40
P3_EMERGENCY_SHOT_SIZE_PERCENT=2.0

# ============================================================================
# EC TARGETS (mS/cm)
# ============================================================================
#
# Target EC values for each phase and steering mode.
# These guide irrigation decisions and EC-based shot adjustments.
#
# VEGETATIVE MODE (Growth phase):
# - Lower EC values
# - Focus on vegetative growth
# - Cannabis typical: 2.5-3.5 mS/cm
#
# GENERATIVE MODE (Flowering/Fruiting phase):
# - Higher EC values
# - Stress for reproductive growth
# - Cannabis typical: 3.5-6.0 mS/cm
#
# EC STACKING:
# - P0: Baseline EC (slightly lower after overnight)
# - P1: Build EC during ramp-up
# - P2: Peak EC (highest concentration)
# - P3: Maintain/slight reduction
#
# ATHENA METHOD REFERENCE:
# Week 1-2 (Veg): 2.5-3.0
# Week 3-4 (Veg): 3.0-3.5
# Week 1-3 (Flower): 3.5-4.5
# Week 4-6 (Flower): 4.5-6.0
# Week 7+ (Flower): 4.0-5.0 (fade)
#
# ============================================================================

# Vegetative EC Targets
EC_TARGET_VEG_P0=3.0
EC_TARGET_VEG_P1=3.0
EC_TARGET_VEG_P2=3.2
EC_TARGET_VEG_P3=3.0

# Generative EC Targets
EC_TARGET_GEN_P0=4.0
EC_TARGET_GEN_P1=5.0
EC_TARGET_GEN_P2=6.0
EC_TARGET_GEN_P3=4.5

# ============================================================================
# FEATURE FLAGS
# ============================================================================
#
# Enable or disable advanced features.
#
# ENABLE_EC_STACKING: Progressive EC increase through phases
#   - true: Use different EC targets for P0/P1/P2/P3
#   - false: Use single EC target for all phases
#   - Recommendation: true for advanced users, false for beginners
#
# ENABLE_ANALYTICS: Statistical analysis and data logging
#   - true: Track dryback rates, shot efficiency, sensor trends
#   - false: Basic operation only
#   - Recommendation: true (minimal performance impact)
#
# ENABLE_ML_FEATURES: Machine learning predictions (EXPERIMENTAL)
#   - true: Predict optimal shot sizes based on history
#   - false: Use fixed calculation methods
#   - Recommendation: false (not fully implemented yet)
#
# ENABLE_MQTT_MONITORING: Publish metrics to MQTT broker
#   - true: Send real-time data to MQTT for external monitoring
#   - false: Home Assistant entities only
#   - Recommendation: false unless you use MQTT monitoring tools
#
# ============================================================================

ENABLE_EC_STACKING=false
ENABLE_ANALYTICS=true
ENABLE_ML_FEATURES=false
ENABLE_MQTT_MONITORING=false

# ============================================================================
# VALIDATION CHECKLIST
# ============================================================================
#
# Before installing, verify:
# ✓ All ZONE_N_SWITCH entities exist in Home Assistant
# ✓ PUMP_SWITCH and MAIN_LINE_SWITCH are correct
# ✓ VWC sensor entity IDs match your sensors (if using)
# ✓ EC sensor entity IDs match your sensors (if using)
# ✓ Light entity and schedule are correct (if using)
# ✓ Substrate volume matches your pot size
# ✓ Dripper flow rate is accurate (test with timer + measuring cup)
# ✓ Phase parameters align with your crop steering strategy
# ✓ EC targets match your nutrient schedule
#
# COMMON MISTAKES:
# ✗ Using "input_boolean.pump" instead of "switch.pump"
# ✗ Forgetting to update ZONE_2 entity IDs (copy-paste from ZONE_1)
# ✗ Setting SUBSTRATE_VOLUME_LITERS in gallons instead of liters
# ✗ Using 12-hour time format instead of 24-hour (18:00 not 6:00 PM)
# ✗ Setting P2_VWC_THRESHOLD higher than P1_TARGET_VWC (causes oscillation)
#
# ============================================================================

# ============================================================================
# INSTALLATION STEPS
# ============================================================================
#
# 1. SAVE THIS FILE:
#    - Rename to: crop_steering.env (remove .example)
#    - Location: /config/crop_steering.env
#    - On Docker: /addon_configs/a0d7b954_appdaemon/crop_steering.env
#
# 2. VALIDATE ENTITY IDs:
#    - Go to: Developer Tools → States
#    - Search for each entity ID you configured
#    - Ensure they exist and are correct type (switch/sensor)
#
# 3. INSTALL INTEGRATION:
#    - Settings → Devices & Services → Add Integration
#    - Search: "Crop Steering"
#    - Choose: "Load from crop_steering.env file"
#    - Review validation warnings (if any)
#    - Click: "Submit"
#
# 4. VERIFY INSTALLATION:
#    - Check: Settings → Devices & Services → Crop Steering
#    - Should see: 100+ entities created
#    - Check: Settings → Devices & Services → Helpers
#    - Should see: Test helper entities (input_boolean, input_number)
#
# 5. CONFIGURE APPDAEMON (Optional but Recommended):
#    - Install: AppDaemon add-on
#    - Install dependencies: pip install scipy numpy
#    - Copy: appdaemon/apps/crop_steering/ to AppDaemon apps directory
#    - Copy: appdaemon/apps/apps.yaml
#    - Restart: AppDaemon add-on
#
# 6. TEST SYSTEM:
#    - Use test helper entities to simulate sensors
#    - Trigger manual irrigation via service call
#    - Monitor AppDaemon logs for automation activity
#
# ============================================================================

# ============================================================================
# SUPPORT & DOCUMENTATION
# ============================================================================
#
# Full Documentation: https://github.com/JakeTheRabbit/HA-Irrigation-Strategy
# Installation Guide: INSTALLATION_WARNINGS.md
# Configuration Guide: ENV_CONFIGURATION_GUIDE.md
# Issue Tracker: https://github.com/JakeTheRabbit/HA-Irrigation-Strategy/issues
#
# ============================================================================
