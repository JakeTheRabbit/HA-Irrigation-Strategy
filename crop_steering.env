# ================================================================
# CROP STEERING SYSTEM CONFIGURATION
# ================================================================
# Edit this file with your Home Assistant entity IDs, then restart HA
# This file configures both AppDaemon automation AND Home Assistant integration entities

# ================================================================
# IRRIGATION HARDWARE (REQUIRED)
# ================================================================
# Main pump and water line controls
PUMP_SWITCH=switch.f1_irrigation_pump_master_switch
MAIN_LINE_SWITCH=switch.espoe_irrigation_relay_1_2
WASTE_SWITCH=

# Zone valve controls
ZONE_1_SWITCH=switch.f1_irrigation_relays_relay_1
ZONE_2_SWITCH=switch.f1_irrigation_relays_relay_2
ZONE_3_SWITCH=switch.f1_irrigation_relays_relay_3

# ================================================================
# ZONE SENSORS (REQUIRED FOR AI)
# ================================================================
# Zone 1 sensors
ZONE_1_VWC_FRONT=sensor.vwc_r1_front
ZONE_1_VWC_BACK=sensor.vwc_r1_back
ZONE_1_EC_FRONT=sensor.ec_r1_front
ZONE_1_EC_BACK=sensor.ec_r1_back

# Zone 2 sensors
ZONE_2_VWC_FRONT=sensor.vwc_r2_front
ZONE_2_VWC_BACK=sensor.vwc_r2_back
ZONE_2_EC_FRONT=sensor.ec_r2_front
ZONE_2_EC_BACK=sensor.ec_r2_back

# Zone 3 sensors
ZONE_3_VWC_FRONT=sensor.vwc_r3_front
ZONE_3_VWC_BACK=sensor.vwc_r3_back
ZONE_3_EC_FRONT=sensor.ec_r3_front
ZONE_3_EC_BACK=sensor.ec_r3_back

# ================================================================
# LIGHTING SYSTEM (Optional - for automatic phase timing)
# ================================================================
LIGHT_ENTITY=light.f1_light_group
LIGHTS_ON_TIME=input_datetime.f1_lights_on_time
LIGHTS_OFF_TIME=input_datetime.f1_lights_off_time

# ================================================================
# ENVIRONMENTAL SENSORS (Optional - for analytics)
# ================================================================
TEMPERATURE_SENSOR=sensor.f1_scd41_back_right_temperature
HUMIDITY_SENSOR=sensor.f1_scd41_back_right_humidity
VPD_SENSOR=sensor.middle_leaf_vpd
WATER_LEVEL_SENSOR=sensor.tank_percentage_full

# ================================================================
# CROP PROFILE SETTINGS
# ================================================================
# Options: Cannabis_Athena, Cannabis_Hybrid, Cannabis_Indica, Cannabis_Sativa, Tomato, Lettuce
DEFAULT_CROP_TYPE=Cannabis_Athena
# Options: Vegetative, Generative
DEFAULT_STEERING_MODE=Vegetative

# ================================================================
# SYSTEM FEATURES
# ================================================================
ENABLE_EC_STACKING=false
ENABLE_ANALYTICS=true
ENABLE_ML_FEATURES=false
ENABLE_MQTT_MONITORING=false

# ================================================================
# SUBSTRATE PROPERTIES (CRITICAL - MEASURE ACCURATELY)
# ================================================================
# Container volume in liters (e.g., 10.0 for 10L pots)
SUBSTRATE_VOLUME_LITERS=3
# Dripper flow rate in liters per hour (measure: time to fill 1L)
DRIPPER_FLOW_RATE_LPH=2.4
# Maximum water capacity (%) - saturate substrate, drain 30min, measure VWC
SUBSTRATE_FIELD_CAPACITY=70
# Maximum safe EC level (mS/cm) - Athena method uses 8-9
SUBSTRATE_MAX_EC=9.0

# ================================================================
# IRRIGATION PARAMETERS (Fine-tune via dashboard later)
# ================================================================

# P0 PHASE - Morning Dryback
P0_VEG_DRYBACK_TARGET=50
P0_GEN_DRYBACK_TARGET=40
P0_MIN_WAIT_TIME=30
P0_MAX_WAIT_TIME=120

# P1 PHASE - Ramp-Up
P1_INITIAL_SHOT_SIZE_PERCENT=2.0
P1_SHOT_SIZE_INCREMENT=0.5
P1_MAX_SHOT_SIZE_PERCENT=10.0
P1_TIME_BETWEEN_SHOTS=15
P1_TARGET_VWC=65
P1_MAX_SHOTS=10
P1_MIN_SHOTS=3

# P2 PHASE - Maintenance
P2_SHOT_SIZE_PERCENT=2
P2_VWC_THRESHOLD=60
P2_EC_HIGH_THRESHOLD=1.2
P2_EC_LOW_THRESHOLD=0.8

# P3 PHASE - Pre-Lights-Off
P3_VEG_LAST_IRRIGATION=120
P3_GEN_LAST_IRRIGATION=180
P3_EMERGENCY_VWC_THRESHOLD=40
P3_EMERGENCY_SHOT_SIZE_PERCENT=2.0

# ================================================================
# EC TARGETS (Athena Method - 3.0 baseline, up to 6.0 generative)
# ================================================================

# Vegetative EC targets (structure building)
EC_TARGET_VEG_P0=3.0
EC_TARGET_VEG_P1=3.0
EC_TARGET_VEG_P2=3.2
EC_TARGET_VEG_P3=3.0

# Generative EC targets (flowering/fruiting)
EC_TARGET_GEN_P0=4.0
EC_TARGET_GEN_P1=5.0
EC_TARGET_GEN_P2=6.0
EC_TARGET_GEN_P3=4.5


NOTIFICATION_SERVICE=notify.mobile_app_s23ultra

# ================================================================
# HOME ASSISTANT INTEGRATION ENTITIES (Auto-created by integration)
# ================================================================
# These entities are created automatically when you add the Crop Steering integration
# through Settings → Devices & Services → Add Integration → Crop Steering

# SYSTEM CONTROL SWITCHES
# switch.crop_steering_system_enabled
# switch.crop_steering_auto_irrigation_enabled  
# switch.crop_steering_ec_stacking_enabled
# switch.crop_steering_analytics_enabled

# ZONE CONTROL SWITCHES (Per Zone 1-N)
# switch.crop_steering_zone_1_enabled
# switch.crop_steering_zone_1_manual_override
# switch.crop_steering_zone_2_enabled
# switch.crop_steering_zone_2_manual_override  
# switch.crop_steering_zone_3_enabled
# switch.crop_steering_zone_3_manual_override

# CONFIGURATION NUMBERS - Substrate & Hardware
# number.crop_steering_substrate_volume (1.0-200.0 L)
# number.crop_steering_dripper_flow_rate (0.1-50.0 L/hr)
# number.crop_steering_drippers_per_plant (1-6 count)
# number.crop_steering_field_capacity (20.0-100.0 %)
# number.crop_steering_max_ec (1.0-20.0 mS/cm)

# CONFIGURATION NUMBERS - Dryback Targets
# number.crop_steering_veg_dryback_target (20.0-80.0 %)
# number.crop_steering_gen_dryback_target (15.0-70.0 %)

# CONFIGURATION NUMBERS - Phase Targets
# number.crop_steering_p1_target_vwc (30.0-95.0 %)
# number.crop_steering_p2_vwc_threshold (25.0-85.0 %)

# CONFIGURATION NUMBERS - P0 Phase Parameters
# number.crop_steering_p0_min_wait_time (5.0-300.0 min)
# number.crop_steering_p0_max_wait_time (30.0-600.0 min)
# number.crop_steering_p0_dryback_drop_percent (2.0-40.0 %)

# CONFIGURATION NUMBERS - P1 Progressive Irrigation
# number.crop_steering_p1_initial_shot_size (0.1-20.0 %)
# number.crop_steering_p1_shot_increment (0.05-10.0 %)
# number.crop_steering_p1_max_shot_size (2.0-50.0 %)
# number.crop_steering_p1_time_between_shots (1.0-60.0 min)
# number.crop_steering_p1_max_shots (1.0-30.0 count)
# number.crop_steering_p1_min_shots (1.0-20.0 count)

# CONFIGURATION NUMBERS - P2 Maintenance Parameters
# number.crop_steering_p2_shot_size (0.5-30.0 %)
# number.crop_steering_p2_ec_high_threshold (0.50-3.00 ratio)
# number.crop_steering_p2_ec_low_threshold (0.20-2.00 ratio)

# CONFIGURATION NUMBERS - P3 Final Phase Parameters
# number.crop_steering_p3_veg_last_irrigation (15.0-360.0 min)
# number.crop_steering_p3_gen_last_irrigation (30.0-600.0 min)
# number.crop_steering_p3_emergency_vwc_threshold (20.0-65.0 %)
# number.crop_steering_p3_emergency_shot_size (0.1-15.0 %)

# CONFIGURATION NUMBERS - EC Target Parameters (Athena Methodology)
# number.crop_steering_ec_target_flush (0.1-15.0 mS/cm)
# number.crop_steering_ec_target_veg_p0 (0.5-15.0 mS/cm)
# number.crop_steering_ec_target_veg_p1 (0.5-15.0 mS/cm)
# number.crop_steering_ec_target_veg_p2 (0.5-15.0 mS/cm)
# number.crop_steering_ec_target_veg_p3 (0.5-15.0 mS/cm)
# number.crop_steering_ec_target_gen_p0 (0.5-20.0 mS/cm)
# number.crop_steering_ec_target_gen_p1 (0.5-20.0 mS/cm)
# number.crop_steering_ec_target_gen_p2 (0.5-20.0 mS/cm)
# number.crop_steering_ec_target_gen_p3 (0.5-20.0 mS/cm)

# CONFIGURATION NUMBERS - System Light Schedule
# number.crop_steering_lights_on_hour (0-23 hour)
# number.crop_steering_lights_off_hour (0-23 hour)

# CONFIGURATION NUMBERS - Zone-Specific (Per Zone 1-N)
# number.crop_steering_zone_1_plant_count (1-50 count)
# number.crop_steering_zone_1_max_daily_volume (0-200 L)
# number.crop_steering_zone_1_shot_size_multiplier (0.1-5.0 factor)
# number.crop_steering_zone_2_plant_count (1-50 count)
# number.crop_steering_zone_2_max_daily_volume (0-200 L)
# number.crop_steering_zone_2_shot_size_multiplier (0.1-5.0 factor)
# number.crop_steering_zone_3_plant_count (1-50 count)
# number.crop_steering_zone_3_max_daily_volume (0-200 L)
# number.crop_steering_zone_3_shot_size_multiplier (0.1-5.0 factor)

# CONFIGURATION SELECTS - System Settings
# select.crop_steering_crop_type (Cannabis_Athena, Cannabis_Hybrid, Cannabis_Indica, Cannabis_Sativa, Tomato, Lettuce, Basil, Custom)
# select.crop_steering_growth_stage (Vegetative, Generative, Transition)
# select.crop_steering_steering_mode (Vegetative, Generative)
# select.crop_steering_irrigation_phase (P0, P1, P2, P3, Manual)

# CONFIGURATION SELECTS - Zone-Specific (Per Zone 1-N)
# select.crop_steering_zone_1_group (Ungrouped, Group A, Group B, Group C, Group D)
# select.crop_steering_zone_1_priority (Critical, High, Normal, Low)
# select.crop_steering_zone_1_crop_profile (Follow Main, Cannabis_Athena, Cannabis_Indica_Dominant, Cannabis_Sativa_Dominant, Cannabis_Balanced_Hybrid, Tomato_Hydroponic, Lettuce_Leafy_Greens, Custom)
# select.crop_steering_zone_2_group (Ungrouped, Group A, Group B, Group C, Group D)
# select.crop_steering_zone_2_priority (Critical, High, Normal, Low)
# select.crop_steering_zone_2_crop_profile (Follow Main, Cannabis_Athena, Cannabis_Indica_Dominant, Cannabis_Sativa_Dominant, Cannabis_Balanced_Hybrid, Tomato_Hydroponic, Lettuce_Leafy_Greens, Custom)
# select.crop_steering_zone_3_group (Ungrouped, Group A, Group B, Group C, Group D)
# select.crop_steering_zone_3_priority (Critical, High, Normal, Low)
# select.crop_steering_zone_3_crop_profile (Follow Main, Cannabis_Athena, Cannabis_Indica_Dominant, Cannabis_Sativa_Dominant, Cannabis_Balanced_Hybrid, Tomato_Hydroponic, Lettuce_Leafy_Greens, Custom)

# MONITORING SENSORS - System-Wide
# sensor.crop_steering_current_phase (Current irrigation phase P0/P1/P2/P3/Manual)
# sensor.crop_steering_irrigation_efficiency (System irrigation efficiency %)
# sensor.crop_steering_water_usage_daily (Total daily water consumption L)
# sensor.crop_steering_dryback_percentage (Current dryback % from peak VWC)
# sensor.crop_steering_next_irrigation_time (Predicted next irrigation time)
# sensor.crop_steering_configured_avg_vwc (Average VWC across all zones %)
# sensor.crop_steering_configured_avg_ec (Average EC across all zones mS/cm)
# sensor.crop_steering_ec_ratio (Current EC to target EC ratio)
# sensor.crop_steering_p2_vwc_threshold_adjusted (EC-adjusted P2 VWC threshold %)

# MONITORING SENSORS - Shot Duration Calculations
# sensor.crop_steering_p1_shot_duration_seconds (P1 irrigation duration seconds)
# sensor.crop_steering_p2_shot_duration_seconds (P2 irrigation duration seconds)
# sensor.crop_steering_p3_shot_duration_seconds (P3 emergency irrigation duration seconds)

# MONITORING SENSORS - Analytics (AppDaemon Generated)
# sensor.crop_steering_system_health_score (Overall system health 0-100%)
# sensor.crop_steering_daily_water_usage (System daily water with analytics)
# sensor.crop_steering_sensor_health (Sensor availability and health %)
# sensor.crop_steering_system_efficiency (Combined system efficiency score)
# sensor.crop_steering_water_efficiency (Water use efficiency VWC per liter)
# sensor.crop_steering_app_current_phase (Zone phase summary Z1:P2, Z2:P1, etc.)
# sensor.crop_steering_app_next_irrigation (AppDaemon calculated next irrigation)
# sensor.crop_steering_system_safety_status (Overall safety status safe/warning/unsafe)

# MONITORING SENSORS - Zone-Specific (Per Zone 1-N)
# sensor.crop_steering_vwc_zone_1 (Zone 1 VWC %)
# sensor.crop_steering_ec_zone_1 (Zone 1 EC mS/cm)
# sensor.crop_steering_zone_1_status (Zone 1 status Optimal/Dry/Saturated/Error)
# sensor.crop_steering_zone_1_last_irrigation (Zone 1 last irrigation timestamp)
# sensor.crop_steering_zone_1_daily_water_usage (Zone 1 daily water L)
# sensor.crop_steering_zone_1_weekly_water_usage (Zone 1 weekly water L)
# sensor.crop_steering_zone_1_irrigation_count_today (Zone 1 irrigations count today)
# sensor.crop_steering_zone_1_health_score (Zone 1 health score 0-1)
# sensor.crop_steering_zone_1_efficiency (Zone 1 irrigation efficiency score)
# sensor.crop_steering_zone_1_safety_status (Zone 1 safety status safe/warning/unsafe)
# (Repeat for zones 2, 3, etc.)

# PREDICTIVE ANALYTICS SENSORS (AppDaemon Generated)
# sensor.crop_steering_prediction_zone_1_next_irrigation_hours (Zone 1 predicted hours until irrigation)
# sensor.crop_steering_prediction_system_vwc_trend (System VWC trend stable/declining/increasing)
# sensor.crop_steering_prediction_estimated_daily_water_need (Predicted daily water requirement L)

# SERVICES AVAILABLE
# crop_steering.transition_phase (target_phase, reason, forced)
# crop_steering.check_transition_conditions
# crop_steering.execute_irrigation_shot (zone, duration_seconds, shot_type)
# crop_steering.set_manual_override (zone, timeout_minutes, enable)

# ================================================================
# INTEGRATION SETUP INSTRUCTIONS
# ================================================================
# 1. Copy custom_components/crop_steering/ to /config/custom_components/
# 2. Restart Home Assistant
# 3. Go to Settings → Devices & Services → Add Integration
# 4. Search for "Crop Steering" and add it
# 5. Configure your zones and sensors through the setup wizard
# 6. Copy appdaemon/apps/crop_steering/ to AppDaemon apps directory
# 7. Add this crop_steering.env to /homeassistant/ directory
# 8. Restart AppDaemon
# 9. All entities above will be available for automation and dashboards